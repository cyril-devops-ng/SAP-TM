*&---------------------------------------------------------------------*
*& Include ztm_pdr_evt
*&---------------------------------------------------------------------*
" ---------------------------------------------------------------------
" 01. Initialization
" ---------------------------------------------------------------------

INITIALIZATION.
  " ---------------------------------------------------------------------
  " 10: Screen titles
  " ---------------------------------------------------------------------
  t1  = `Output Selection`.
  tta = `Action Selection`.

  " ---------------------------------------------------------------------
  " 02: At Selection-screen Output
  " ---------------------------------------------------------------------

AT SELECTION-SCREEN OUTPUT.
  IF p_r_fom = abap_true.
    zpdr_hide_screen_fields 'ALV'.
    zpdr_show_screen_fields 'FOM'.
    t1 = 'Form Print-Out Selection'.
  ELSE.
    zpdr_hide_screen_fields 'FOM'.
    zpdr_show_screen_fields 'ALV'.
    t1 = 'ALV Report Selection'.
  ENDIF.
  " ---------------------------------------------------------------------
  " 03. Start-of-selection
  " ---------------------------------------------------------------------

START-OF-SELECTION.
  " ---------------------------------------------------------------------
  " 10: Form Display Sel. Opt
  " ---------------------------------------------------------------------
  IF p_r_fom = abap_true.
    TRY.
        " ---------------------------------------------------------------------
        " 20: Create Instance
        " ---------------------------------------------------------------------
        DATA(lo_pdr_req) = NEW lcl_pdr( it_fwq_no = s_fwq_no[]
                                        it_bl_no  = s_bolno[]
                                        if_mantyp = s_mantyp ).
        " ---------------------------------------------------------------------
        " 30: Retrieve document
        " ---------------------------------------------------------------------
        lo_pdr_req->retrieve____freightdocs( ).
        " ---------------------------------------------------------------------
        " 40: Create PDR form items
        " ---------------------------------------------------------------------
        lo_pdr_req->create_pdr_form_items( ).
        lo_pdr_req->pdr____modfiy_records( ).
        " ---------------------------------------------------------------------
        " 50: Check Print Data exists
        " ---------------------------------------------------------------------
        IF lo_pdr_req->gt_header IS NOT INITIAL.
          gs_header = lo_pdr_req->gt_header[ 1 ].
          " ---------------------------------------------------------------------
          " 60: Display output
          " ---------------------------------------------------------------------
          lo_pdr_req->show_form( ).
        ENDIF.
        " ---------------------------------------------------------------------
        " 70: Catch exceptions
        " ---------------------------------------------------------------------
      CATCH zcx_tm_form_exception INTO DATA(lo_pdr_ex).
        " ---------------------------------------------------------------------
        " 80: Handle. excp. msgs
        " ---------------------------------------------------------------------
        DATA(lt_msg) = zcl_tm_form_helper=>create_bapi_ret_from_exception( lo_pdr_ex ).
        zcl_tm_form_helper=>display_bapi_log_gui( lt_msg ).
    ENDTRY.
  ELSE.
    " ---------------------------------------------------------------------
    " 90: Display report
    " ---------------------------------------------------------------------
    CALL SCREEN lcl_pdr=>report.
  ENDIF.
